<!DOCTYPE html>
<html lang="en">
<head>




<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<meta name="generator" content="Orchid 0.17.5"/>
<link rel="icon" href="/ecodex/favicon.ico">


<meta name="robots" content="index, follow">



<title>Configuration Update</title>


<meta name="description" content="This site contains technical documentation of the e-Codex Components">



<link rel="prev" href="/ecodex/wiki/ecodex/example_deployment">


<link rel="next" href="/ecodex/wiki/ecodex/differences_edelivery_ecodex">


<script>
    window.site = {"orchidVersion":"0.17.5","baseUrl":"/ecodex","environment":"debug","version":"1.0-SNAPSHOT"};
</script>





<!-- start:debug info -->

<!-- THEME -->
<!-- Type: BsDoc -->
<!-- Class: com.eden.orchid.bsdoc.BSDocTheme -->

<!-- PAGE -->
<!-- Type: wiki -->
<!-- Class: com.eden.orchid.wiki.pages.WikiPage -->
<!-- Layout: index -->
<!-- Resolved Layout: templates/layouts/index.peb -->
<!-- Page Template: wiki, page -->
<!-- Resolved Page Template:  -->

<!-- RESOURCE -->
<!-- Class: com.eden.orchid.api.resources.resource.FileResource -->
<!-- Source Filename: wiki/ecodex/configuration_update.ad -->

<!-- COMPLETE PAGE CONFIGURATION -->
<script>
    window.allData = {"reference":{"path":"wiki/ecodex","baseUrl":"/ecodex","fileName":"configuration_update","extension":"html","usePrettyUrl":true,"link":"/ecodex/wiki/ecodex/configuration_update"},"next":{"path":"wiki/ecodex","baseUrl":"/ecodex","fileName":"differences_edelivery_ecodex","extension":"html","usePrettyUrl":true,"link":"/ecodex/wiki/ecodex/differences_edelivery_ecodex"},"previous":{"path":"wiki/ecodex","baseUrl":"/ecodex","fileName":"example_deployment","extension":"html","usePrettyUrl":true,"link":"/ecodex/wiki/ecodex/example_deployment"},"description":"","title":"Configuration Update"};
</script>

<!-- end:debug info -->



<!-- start:inject styles -->
<link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"/>
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css"/>
<link rel="stylesheet" type="text/css" href="/ecodex/BsDoc/75cb1e73/assets/css/bsdoc.css"/>
<link rel="stylesheet" type="text/css" href="/ecodex/BsDoc/75cb1e73/assets/css/orchidSearch.css"/>
<link rel="stylesheet" type="text/css" href="/ecodex/assets/css/extraCss.css"/>
<link rel="stylesheet" type="text/css" href="/ecodex/assets/ecodex/css/ecodex.css"/>
<link rel="stylesheet" type="text/css" href="/ecodex/assets/css/pygments.css"/>
<!-- end:inject styles -->


</head>
<body>





<header class="navbar navbar-fixed-top bs-docs-nav">
    <div class="container">
        <div class="navbar-header" role="banner">
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/ecodex">e-Codex</a>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
            <ul class="nav navbar-nav navbar-right">
                
                    
                        <li><a href="/ecodex">Home</a></li>
                    
                
                    
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">ecodex<span class="caret"></span></a>
                            <ul class="dropdown-menu scrollable-menu">
                                
                                    <li><a href="/ecodex/wiki/ecodex/ecodex_protocol">e-Codex Protocol specification</a></li>
                                
                                    <li><a href="/ecodex/wiki/ecodex/example_deployment">Example Deployment</a></li>
                                
                                    <li><a href="/ecodex/wiki/ecodex/configuration_update">Configuration Update</a></li>
                                
                                    <li><a href="/ecodex/wiki/ecodex/differences_edelivery_ecodex">Differences between e-Codex and e-Delivery</a></li>
                                
                            </ul>
                        </li>
                    
                
            </ul>
        </nav>
    </div>
</header>




<div id="top"></div>



    /ecodex/assets/ecodex/media/e-CODEX_home_1500-2.jpg

    <div class="bs-docs-masthead" id="jumbotron" style="background-image: url(&quot;/ecodex/assets/ecodex/media/e-CODEX_home_1500-2.jpg&quot;);" >
        <div class="container">
            <h1 class="home-title">Configuration Update</h1>
        </div>
    </div>


<div class="container bs-docs-container">
    <div class="row">
        <div class="col-md-9" role="main">
        <nav aria-label="breadcrumb">
    <ul class="breadcrumb">
    
    
        <li class="breadcrumb-item"><a href="/ecodex/wiki/ecodex">E Codex</a></li>
    
    
    
        <li class="breadcrumb-item active" aria-current="page">Configuration Update</li>
    
    
    </ul>
</nav>
        

        
        
            
    <!-- start:inject components -->
    
        
            
                
                    
                        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The e-Codex environment establishes the connection betweent the access points (usually domibus gateway) over https connections.
For this purpose multiple configuration parameters are necessary.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Table Configuration Parameters</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Configuration Item</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access-Point URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The https address where the Gateway is reachable.&lt;br&gt; eg: <a href="https://ecodexgw.example.com/domibus/services/msh" class="bare">https://ecodexgw.example.com/domibus/services/msh</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incoming IP-Addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP-Addresses which are used for incoming traffic. This would enable your e-Codex partners to only allow traffic to this IP-Adresses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outgoing IP-Addresses</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP-Addresses which the connection is made from. This will help your partners to only allow this specific ips to access thier webserver. Its mostly for a security reason to block unwanted access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS/SSL Webserver-Server certificate (1)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">As the Request are sent over HTTPS the webserver needs a Certificate. An alias name of the certificate must match the domain name. The whole certificate-chain must be shared with your e-Codex partners. The certificate is used by the server to authenticate itself. The webserver client (the gateway, when it is sending a message) is validating this certificate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS/SSL Webserver-Client certificate (2)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not only the server needs to authenticate itself, also the client is required to authenticate itself at the webserver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access-Point/Gateway Certificate     (3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The by the gateway sent messages are being signed. For this purpose the gateway needs a certificate. This certficiate must be distributed to the other partners to ensure trust and also to enable the other gateways to encrypt the message, when sent to your gateway.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connector/e-Codex Certificate        (4)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The by the connector generated ASIC-S Container and evidences are also signed. For this purpose the connector also needs a certificate. This certificate must also be shared with your partners to ensure trust</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All these configuration parameters can be configured on the CMT. The CMT is able to merge all this configurations together
and generate a package for each e-Codex member. After this step the package must be downloaded and the
configuration of each member has to be updated.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_configuration_package">Example Configuration Package</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">Example Configuration Package</div>
<p><span class="image"><img src="../../../assets/media/images/ecodex_sample_configuration_package.png" alt="ecodex sample configuration package"></span></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Table Distributed Configuration Files</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trusted_https_servers.pem      (a)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate chains of all trusted webservers (1) in the pem-format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trusted_https_servers.jks      (b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate chains fo all trusted webserver  (1) in java key store format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trusted_https_clients.pem      (c)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate chains of all trusted webserver (2) clients in pem-format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trusted_https_clients.jks      (d)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate chains of all trusted webserver (2) clients in jks-format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trusted_gateways.jks           (e)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate chains of all trusted gateways (3)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">trusted_connectors.jks         (f)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The certificate chains of all trusted connectors (4)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">eDeliveryAS4Policy.xml         (g)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This file contains the ws-security-policy and defines which encryption and signature algorithms are allowed between 2 access-points. It also defines if 2-way TLS/SSL encryption/authentication is required or optional.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domibus-configuration-&lt;country&gt;.xml  (h)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This file contains the p-Mode configuration. The p-modes are defining the connection parameters between two access-points. Within the p-Modes also the securityPolicy is referenced. They also define which message types are allowed.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_jks_vs_pem_format">JKS vs. PEM-Format</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The jks format is the default keystore format in java. The PEM-Format on the other side is used within apache webservers. It
contains the certificates Base64 encoded in a text file.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_update_overview">Configuration Update Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following files needs to be copied or uploaded:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>trusted_https_clients.pem (c) must be copied to the Webserver</p>
</li>
<li>
<p>trusted_gateways.jks (e) must be uploaded via the domibus UI into the domibus gw</p>
</li>
<li>
<p>domibus-configuration-&lt;country&gt;.xml (h) must be uploaded via the domibus UI into the domibus gw</p>
</li>
<li>
<p>trusted_https_servers.jks (b) must be copied into the domibus conf keystores folder</p>
</li>
<li>
<p>trusted_connectors.jks (f) must be copied into the domibus connector keystores folder</p>
</li>
<li>
<p>domibus-configuration-&lt;country&gt;.xml (h) <strong>must also</strong> be uploaded via the admin UI into the domibus <strong>connector</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Configuration update overview</div>
<p><span class="image"><img src="../../../assets/media/images/ecodex_ConfigurationUpdate.png" alt="ecodex ConfigurationUpdate"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_update_webserver_configuration">Update Webserver Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If 2way-ssl is enabled the webserver is doing the client authentication. So the webserver configuration needs to be updated.
If you are using the example configuration, the trusted_https_clients.pem file must be copied into the apache configuration.
The following code-block contains an <strong>example</strong> Apache 2way-SSL-Configration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;VirtualHost _default_:443&gt;
  SSLEngine on
  ServerName localhost:443
  SSLCertificateFile "${SRVROOT}/conf/ssl/server.crt"
  SSLCertificateKeyFile "${SRVROOT}/conf/ssl/server.key"
  # The following Parameter holds all trusted client certificates (2)
  # (and thier parent certificates) in pem-format.
  SSLCACertificateFile "${SRVROOT}/conf/ssl/trusted_clients.pem"
  DocumentRoot "${SRVROOT}/htdocs"

	CustomLog "${SRVROOT}/logs/ssl_request.log" \
          "%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"
	&lt;Directory "${SRVROOT}/htdocs"&gt;
		Options Indexes Includes FollowSymLinks
		AllowOverride AuthConfig Limit FileInfo
    Require all granted
	&lt;/Directory&gt;

  #always protect the whole v-host to avoid post-handshake authentication!
  SSLVerifyClient Require


  &lt;Location "/domibus/services/msh" &gt;
    ProxyPass &lt;gateway&gt;/domibus/services/msh
    ProxyPassReverse &lt;gateway&gt;/domibus/services/msh
  &lt;/Location&gt;


&lt;/virtualhost&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_update_gateway_configuration">Update Gateway Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The gateway needs to be updated on 3 places:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The trusted webserver certificates (file (b))</p>
</li>
<li>
<p>The trusted gateway certificates (file (e))</p>
</li>
<li>
<p>The p-Modes itself (file (h))</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sometimes also an update of the security policy may be necessary.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
This description only gives a brief overview. For more details consult the gateway administration guide!
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_update_gateway_client_configuration_trusted_https_servers_jks_b">Update Gateway Client Configuration | trusted_https_servers.jks (b)</h3>
<div class="paragraph">
<p>If a webserver certificate changes the trusted_https_servers.jks must be copied to the location configured
within the clientauthentication.xml file. The file is usually located under</p>
</div>
<div class="paragraph">
<p>&lt;domibus_tomcat&gt;/conf/domibus/clientauthentication.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-$xml" data-lang="$xml">&lt;http-conf:tlsClientParameters disableCNCheck="true" secureSocketProtocol="TLSv1.2"
  xmlns:http-conf="http://cxf.apache.org/transports/http/configuration"
  xmlns:security="http://cxf.apache.org/configuration/security"&gt;

  &lt;security:trustManagers&gt;
    &lt;!-- the following line contains the store which holds all trusted
    webserver certificates (file (b)) and thier parent certificates --&gt;
    &lt;security:keyStore type="JKS"
        password="changeit"
        file="${domibus.config.location}/keystores/trusted_https_servers.jks"
    /&gt;
  &lt;/security:trustManagers&gt;
  &lt;security:keyManagers keyPassword="12345"&gt;
  &lt;!-- this key store contains the web client private key,
  the public certificate is distributed with
  the trusted_https_clients store  --&gt;
    &lt;security:keyStore
        type="JKS"
        password="12345"
        file="${domibus.config.location}/keystores/https_client_keystore.jks"
    /&gt;
  &lt;/security:keyManagers&gt;
&lt;/http-conf:tlsClientParameters&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_update_trusted_gateways_configuration">Update Trusted Gateways Configuration</h3>
<div class="paragraph">
<p>The gateway certificates are updated by uploading the trusted_gateways.jks (file (e)) into the domibus gateway.
This can be done with the admin ui. A restart is not required.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../assets/media/images/screenshot_gateway_truststore_upload.png" alt="screenshot gateway truststore upload">
</div>
<div class="title">Figure 1. Upload Truststore</div>
</div>
</div>
<div class="sect2">
<h3 id="_update_p_modes">Update p-Modes</h3>
<div class="paragraph">
<p>The p-Modes can also be updated by uploading the new p-modes file with the admin-ui. A restart is not required.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_update_connector_configuration">Update Connector Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Within the connector the following parameters must be updated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>p-Modes (connector: 4.0, 4.1)</p>
</li>
<li>
<p>trusted connector certificates</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_update_connector_p_modes_configuration">Update Connector p-Modes Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The connector (4.0, 4.1) also requires the upload of the p-Modes. This can be done with the connector admin ui.
Log into the admin ui and upload the p-Modes file.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../assets/media/images/screenshot_update_connector_p_modes.png" alt="p-modes connector upload">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_update_trusted_connectors_certificates">Update Trusted Connectors Certificates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Currently it is not possible to update the trusted-connector certificates within the admin-ui. The keystore has to
be replaced. To do this copy the file (f) to</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;connector_tomcat&gt;/conf/connector/keystores/trusted_connectors.jks</pre>
</div>
</div>
<div class="paragraph">
<p>And make sure that the connector property [connector.security.trust-store.path] points to that location!
The following block contains an excerpt of the connector configuration with the relevant properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>#############################  connector truststore  #############################

# Holds all public keys of partners to validate
# sent and received ASIC-S containers against.
#

connector.security.trust-store.path=file:./conf/connector/keystores/trusted_connectors.jks
connector.security.trust-store.password=changeit</code></pre>
</div>
</div>
</div>
</div>
                    
                
            
        
    
    <!-- end:inject components -->


        
        </div>

        <!-- Page navigation
        =========================================== -->
        <div class="col-md-3" role="complementary">
        <div class="bs-docs-sidebar hidden-print" id="bs-docs-sidebar">
    
        <section id="search" >
            <form data-orchid-search="">
                <div class="input-group">
                    <input type="text" name="query" id="query" class="form-control" placeholder="Search&hellip;">
                    <span class="input-group-btn"><button type="submit" class="btn btn-default">Go</button></span>
                </div>
            </form>
            <div id="search-results" data-orchid-search-results style="display: none;">
                <b>Search Results</b>
                <ul></ul>
            </div>
            <div id="search-progress" data-orchid-search-progress style="display: none;">
                <div class="loader">Loading...</div>
            </div>
        </section>
    

    <ul class="nav bs-docs-sidenav">
        
    </ul>

    
    <!-- start:inject components -->
    
    <!-- end:inject components -->



    <a class="back-to-top" href="#top">
        <i class="glyphicon glyphicon-chevron-up"></i> Back to top
    </a>
</div>

        </div>
    </div>
</div>


<div id="footer">
    <div class="container bs-docs-container">
    <footer class="bs-docs-footer" role="contentinfo">
    <div class="row">
        <div class="col-xs-12">
            <nav aria-label="navigateClasses">
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/ecodex/wiki/ecodex/example_deployment">
                                <span aria-hidden="true">&larr;</span>
                                <span>Example Deployment</span>
                            </a>
                        </li>
                    

                    
                        <li class="next">
                            <a href="/ecodex/wiki/ecodex/differences_edelivery_ecodex">
                                <span>Differences between e-Codex and e-Delivery</span>
                                <span aria-hidden="true">&rarr;</span>
                            </a>
                        </li>
                    
                </ul>
            </nav>
        </div>
    </div>
    <div class="icons">
    
    
    
    </div>
    <br>
    <p>
    Documentation template based on the
    <a href="https://github.com/mistic100/jekyll-bootstrap-doc">Jekyll Bootstrap Doc</a>
    Jekyll theme by the <a href="https://getbootstrap.com">Bootstrap team</a>. Site created with
    <a href="https://orchid.netlify.com">Orchid</a>.
</p>

<ul class="bs-docs-footer-links muted">
    <li>Currently 1.0-SNAPSHOT</li>
</ul>

</footer>
    </div>
</div>


<!-- start:inject scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.3.0/bootbox.min.js"></script>
<script src="/ecodex/BsDoc/75cb1e73/assets/js/bsdoc.js"></script>
<script src="https://unpkg.com/lunr/lunr.js"></script>
<script src="/ecodex/BsDoc/75cb1e73/assets/js/orchidSearch.js"></script>
<script src="/ecodex/assets/js/extraJs.js"></script>
<!-- end:inject scripts -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
    

<script>
    $(function () {
        window.colors = ['#4C376C', '#000000'];
                  
        buildNav();
    });
</script>

</body>
</html>