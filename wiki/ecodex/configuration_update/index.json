{
  "reference": {
    "path": "wiki/ecodex",
    "baseUrl": "/ecodex",
    "fileName": "configuration_update",
    "extension": "html",
    "usePrettyUrl": true,
    "link": "/ecodex/wiki/ecodex/configuration_update"
  },
  "next": {
    "path": "wiki/ecodex",
    "baseUrl": "/ecodex",
    "fileName": "differences_edelivery_ecodex",
    "extension": "html",
    "usePrettyUrl": true,
    "link": "/ecodex/wiki/ecodex/differences_edelivery_ecodex"
  },
  "previous": {
    "path": "wiki/ecodex",
    "baseUrl": "/ecodex",
    "fileName": "example_deployment",
    "extension": "html",
    "usePrettyUrl": true,
    "link": "/ecodex/wiki/ecodex/example_deployment"
  },
  "data": {},
  "description": "",
  "title": "Configuration Update",
  "content": "<div id=\"preamble\">\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The e-Codex environment establishes the connection betweent the access points (usually domibus gateway) over https connections.\nFor this purpose multiple configuration parameters are necessary.<\/p>\n<\/div>\n<table class=\"tableblock frame-all grid-all stretch\">\n<caption class=\"title\">Table 1. Table Configuration Parameters<\/caption>\n<colgroup>\n<col style=\"width: 50%;\">\n<col style=\"width: 50%;\">\n<\/colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">Configuration Item<\/th>\n<th class=\"tableblock halign-left valign-top\">Description<\/th>\n<\/tr>\n<\/thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Access-Point URL<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">The https address where the Gateway is reachable.&lt;br&gt; eg: <a href=\"https://ecodexgw.example.com/domibus/services/msh\" class=\"bare\">https://ecodexgw.example.com/domibus/services/msh<\/a><\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Incoming IP-Addresses<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">IP-Addresses which are used for incoming traffic. This would enable your e-Codex partners to only allow traffic to this IP-Adresses<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Outgoing IP-Addresses<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">IP-Addresses which the connection is made from. This will help your partners to only allow this specific ips to access thier webserver. Its mostly for a security reason to block unwanted access<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">TLS/SSL Webserver-Server certificate (1)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">As the Request are sent over HTTPS the webserver needs a Certificate. An alias name of the certificate must match the domain name. The whole certificate-chain must be shared with your e-Codex partners. The certificate is used by the server to authenticate itself. The webserver client (the gateway, when it is sending a message) is validating this certificate.<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">TLS/SSL Webserver-Client certificate (2)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Not only the server needs to authenticate itself, also the client is required to authenticate itself at the webserver<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Access-Point/Gateway Certificate     (3)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">The by the gateway sent messages are being signed. For this purpose the gateway needs a certificate. This certficiate must be distributed to the other partners to ensure trust and also to enable the other gateways to encrypt the message, when sent to your gateway.<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">Connector/e-Codex Certificate        (4)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">The by the connector generated ASIC-S Container and evidences are also signed. For this purpose the connector also needs a certificate. This certificate must also be shared with your partners to ensure trust<\/p><\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<div class=\"paragraph\">\n<p>All these configuration parameters can be configured on the CMT. The CMT is able to merge all this configurations together\nand generate a package for each e-Codex member. After this step the package must be downloaded and the\nconfiguration of each member has to be updated.<\/p>\n<\/div>\n<\/div>\n<\/div>\n<div class=\"sect1\">\n<h2 id=\"_example_configuration_package\">Example Configuration Package<\/h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<div class=\"title\">Example Configuration Package<\/div>\n<p><span class=\"image\"><img src=\"../../../assets/media/images/ecodex_sample_configuration_package.png\" alt=\"ecodex sample configuration package\"><\/span><\/p>\n<\/div>\n<table class=\"tableblock frame-all grid-all stretch\">\n<caption class=\"title\">Table 2. Table Distributed Configuration Files<\/caption>\n<colgroup>\n<col style=\"width: 50%;\">\n<col style=\"width: 50%;\">\n<\/colgroup>\n<thead>\n<tr>\n<th class=\"tableblock halign-left valign-top\">Name<\/th>\n<th class=\"tableblock halign-left valign-top\">Description<\/th>\n<\/tr>\n<\/thead>\n<tbody>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">trusted_https_servers.pem      (a)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">The certificate chains of all trusted webservers (1) in the pem-format.<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">trusted_https_servers.jks      (b)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">The certificate chains fo all trusted webserver  (1) in java key store format.<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">trusted_https_clients.pem      (c)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">The certificate chains of all trusted webserver (2) clients in pem-format.<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">trusted_https_clients.jks      (d)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">The certificate chains of all trusted webserver (2) clients in jks-format<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">trusted_gateways.jks           (e)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">The certificate chains of all trusted gateways (3)<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">trusted_connectors.jks         (f)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">The certificate chains of all trusted connectors (4)<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">eDeliveryAS4Policy.xml         (g)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">This file contains the ws-security-policy and defines which encryption and signature algorithms are allowed between 2 access-points. It also defines if 2-way TLS/SSL encryption/authentication is required or optional.<\/p><\/td>\n<\/tr>\n<tr>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">domibus-configuration-&lt;country&gt;.xml  (h)<\/p><\/td>\n<td class=\"tableblock halign-left valign-top\"><p class=\"tableblock\">This file contains the p-Mode configuration. The p-modes are defining the connection parameters between two access-points. Within the p-Modes also the securityPolicy is referenced. They also define which message types are allowed.<\/p><\/td>\n<\/tr>\n<\/tbody>\n<\/table>\n<\/div>\n<\/div>\n<div class=\"sect1\">\n<h2 id=\"_jks_vs_pem_format\">JKS vs. PEM-Format<\/h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The jks format is the default keystore format in java. The PEM-Format on the other side is used within apache webservers. It\ncontains the certificates Base64 encoded in a text file.<\/p>\n<\/div>\n<\/div>\n<\/div>\n<div class=\"sect1\">\n<h2 id=\"_configuration_update_overview\">Configuration Update Overview<\/h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The following files needs to be copied or uploaded:<\/p>\n<\/div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>trusted_https_clients.pem (c) must be copied to the Webserver<\/p>\n<\/li>\n<li>\n<p>trusted_gateways.jks (e) must be uploaded via the domibus UI into the domibus gw<\/p>\n<\/li>\n<li>\n<p>domibus-configuration-&lt;country&gt;.xml (h) must be uploaded via the domibus UI into the domibus gw<\/p>\n<\/li>\n<li>\n<p>trusted_https_servers.jks (b) must be copied into the domibus conf keystores folder<\/p>\n<\/li>\n<li>\n<p>trusted_connectors.jks (f) must be copied into the domibus connector keystores folder<\/p>\n<\/li>\n<li>\n<p>domibus-configuration-&lt;country&gt;.xml (h) <strong>must also<\/strong> be uploaded via the admin UI into the domibus <strong>connector<\/strong><\/p>\n<\/li>\n<\/ul>\n<\/div>\n<div class=\"paragraph\">\n<div class=\"title\">Configuration update overview<\/div>\n<p><span class=\"image\"><img src=\"../../../assets/media/images/ecodex_ConfigurationUpdate.png\" alt=\"ecodex ConfigurationUpdate\"><\/span><\/p>\n<\/div>\n<\/div>\n<\/div>\n<div class=\"sect1\">\n<h2 id=\"_update_webserver_configuration\">Update Webserver Configuration<\/h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>If 2way-ssl is enabled the webserver is doing the client authentication. So the webserver configuration needs to be updated.\nIf you are using the example configuration, the trusted_https_clients.pem file must be copied into the apache configuration.\nThe following code-block contains an <strong>example<\/strong> Apache 2way-SSL-Configration.<\/p>\n<\/div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code>&lt;VirtualHost _default_:443&gt;\n  SSLEngine on\n  ServerName localhost:443\n  SSLCertificateFile \"${SRVROOT}/conf/ssl/server.crt\"\n  SSLCertificateKeyFile \"${SRVROOT}/conf/ssl/server.key\"\n  # The following Parameter holds all trusted client certificates (2)\n  # (and thier parent certificates) in pem-format.\n  SSLCACertificateFile \"${SRVROOT}/conf/ssl/trusted_clients.pem\"\n  DocumentRoot \"${SRVROOT}/htdocs\"\n\n\tCustomLog \"${SRVROOT}/logs/ssl_request.log\" \\\n          \"%t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \\\"%r\\\" %b\"\n\t&lt;Directory \"${SRVROOT}/htdocs\"&gt;\n\t\tOptions Indexes Includes FollowSymLinks\n\t\tAllowOverride AuthConfig Limit FileInfo\n    Require all granted\n\t&lt;/Directory&gt;\n\n  #always protect the whole v-host to avoid post-handshake authentication!\n  SSLVerifyClient Require\n\n\n  &lt;Location \"/domibus/services/msh\" &gt;\n    ProxyPass &lt;gateway&gt;/domibus/services/msh\n    ProxyPassReverse &lt;gateway&gt;/domibus/services/msh\n  &lt;/Location&gt;\n\n\n&lt;/virtualhost&gt;<\/code><\/pre>\n<\/div>\n<\/div>\n<\/div>\n<\/div>\n<div class=\"sect1\">\n<h2 id=\"_update_gateway_configuration\">Update Gateway Configuration<\/h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The gateway needs to be updated on 3 places:<\/p>\n<\/div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>The trusted webserver certificates (file (b))<\/p>\n<\/li>\n<li>\n<p>The trusted gateway certificates (file (e))<\/p>\n<\/li>\n<li>\n<p>The p-Modes itself (file (h))<\/p>\n<\/li>\n<\/ul>\n<\/div>\n<div class=\"paragraph\">\n<p>Sometimes also an update of the security policy may be necessary.<\/p>\n<\/div>\n<div class=\"admonitionblock important\">\n<table>\n<tr>\n<td class=\"icon\">\n<div class=\"title\">Important<\/div>\n<\/td>\n<td class=\"content\">\nThis description only gives a brief overview. For more details consult the gateway administration guide!\n<\/td>\n<\/tr>\n<\/table>\n<\/div>\n<div class=\"sect2\">\n<h3 id=\"_update_gateway_client_configuration_trusted_https_servers_jks_b\">Update Gateway Client Configuration | trusted_https_servers.jks (b)<\/h3>\n<div class=\"paragraph\">\n<p>If a webserver certificate changes the trusted_https_servers.jks must be copied to the location configured\nwithin the clientauthentication.xml file. The file is usually located under<\/p>\n<\/div>\n<div class=\"paragraph\">\n<p>&lt;domibus_tomcat&gt;/conf/domibus/clientauthentication.xml<\/p>\n<\/div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code class=\"language-$xml\" data-lang=\"$xml\">&lt;http-conf:tlsClientParameters disableCNCheck=\"true\" secureSocketProtocol=\"TLSv1.2\"\n  xmlns:http-conf=\"http://cxf.apache.org/transports/http/configuration\"\n  xmlns:security=\"http://cxf.apache.org/configuration/security\"&gt;\n\n  &lt;security:trustManagers&gt;\n    &lt;!-- the following line contains the store which holds all trusted\n    webserver certificates (file (b)) and thier parent certificates --&gt;\n    &lt;security:keyStore type=\"JKS\"\n        password=\"changeit\"\n        file=\"${domibus.config.location}/keystores/trusted_https_servers.jks\"\n    /&gt;\n  &lt;/security:trustManagers&gt;\n  &lt;security:keyManagers keyPassword=\"12345\"&gt;\n  &lt;!-- this key store contains the web client private key,\n  the public certificate is distributed with\n  the trusted_https_clients store  --&gt;\n    &lt;security:keyStore\n        type=\"JKS\"\n        password=\"12345\"\n        file=\"${domibus.config.location}/keystores/https_client_keystore.jks\"\n    /&gt;\n  &lt;/security:keyManagers&gt;\n&lt;/http-conf:tlsClientParameters&gt;<\/code><\/pre>\n<\/div>\n<\/div>\n<\/div>\n<div class=\"sect2\">\n<h3 id=\"_update_trusted_gateways_configuration\">Update Trusted Gateways Configuration<\/h3>\n<div class=\"paragraph\">\n<p>The gateway certificates are updated by uploading the trusted_gateways.jks (file (e)) into the domibus gateway.\nThis can be done with the admin ui. A restart is not required.<\/p>\n<\/div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"../../../assets/media/images/screenshot_gateway_truststore_upload.png\" alt=\"screenshot gateway truststore upload\">\n<\/div>\n<div class=\"title\">Figure 1. Upload Truststore<\/div>\n<\/div>\n<\/div>\n<div class=\"sect2\">\n<h3 id=\"_update_p_modes\">Update p-Modes<\/h3>\n<div class=\"paragraph\">\n<p>The p-Modes can also be updated by uploading the new p-modes file with the admin-ui. A restart is not required.<\/p>\n<\/div>\n<\/div>\n<\/div>\n<\/div>\n<div class=\"sect1\">\n<h2 id=\"_update_connector_configuration\">Update Connector Configuration<\/h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Within the connector the following parameters must be updated:<\/p>\n<\/div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>p-Modes (connector: 4.0, 4.1)<\/p>\n<\/li>\n<li>\n<p>trusted connector certificates<\/p>\n<\/li>\n<\/ul>\n<\/div>\n<\/div>\n<\/div>\n<div class=\"sect1\">\n<h2 id=\"_update_connector_p_modes_configuration\">Update Connector p-Modes Configuration<\/h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>The connector (4.0, 4.1) also requires the upload of the p-Modes. This can be done with the connector admin ui.\nLog into the admin ui and upload the p-Modes file.<\/p>\n<\/div>\n<div class=\"imageblock\">\n<div class=\"content\">\n<img src=\"../../../assets/media/images/screenshot_update_connector_p_modes.png\" alt=\"p-modes connector upload\">\n<\/div>\n<\/div>\n<\/div>\n<\/div>\n<div class=\"sect1\">\n<h2 id=\"_update_trusted_connectors_certificates\">Update Trusted Connectors Certificates<\/h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph\">\n<p>Currently it is not possible to update the trusted-connector certificates within the admin-ui. The keystore has to\nbe replaced. To do this copy the file (f) to<\/p>\n<\/div>\n<div class=\"literalblock\">\n<div class=\"content\">\n<pre>&lt;connector_tomcat&gt;/conf/connector/keystores/trusted_connectors.jks<\/pre>\n<\/div>\n<\/div>\n<div class=\"paragraph\">\n<p>And make sure that the connector property [connector.security.trust-store.path] points to that location!\nThe following block contains an excerpt of the connector configuration with the relevant properties.<\/p>\n<\/div>\n<div class=\"listingblock\">\n<div class=\"content\">\n<pre class=\"highlight\"><code>#############################  connector truststore  #############################\n\n# Holds all public keys of partners to validate\n# sent and received ASIC-S containers against.\n#\n\nconnector.security.trust-store.path=file:./conf/connector/keystores/trusted_connectors.jks\nconnector.security.trust-store.password=changeit<\/code><\/pre>\n<\/div>\n<\/div>\n<\/div>\n<\/div>"
}