<!DOCTYPE html>
<html lang="en">
<head>




<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
<meta name="generator" content="Orchid 0.17.5"/>
<link rel="icon" href="/e-codex/ecodex/favicon.ico">


<meta name="robots" content="index, follow">



<title>Example Deployment</title>


<meta name="description" content="This site contains technical documentation of the e-Codex Components">



<link rel="prev" href="/e-codex/ecodex/wiki/ecodex/ecodex_protocol">


<link rel="next" href="/e-codex/ecodex/wiki/ecodex/configuration_update">


<script>
    window.site = {"orchidVersion":"0.17.5","baseUrl":"/e-codex/ecodex","environment":"debug","version":"1.0-SNAPSHOT"};
</script>





<!-- start:debug info -->

<!-- THEME -->
<!-- Type: BsDoc -->
<!-- Class: com.eden.orchid.bsdoc.BSDocTheme -->

<!-- PAGE -->
<!-- Type: wiki -->
<!-- Class: com.eden.orchid.wiki.pages.WikiPage -->
<!-- Layout: index -->
<!-- Resolved Layout: templates/layouts/index.peb -->
<!-- Page Template: wiki, page -->
<!-- Resolved Page Template:  -->

<!-- RESOURCE -->
<!-- Class: com.eden.orchid.api.resources.resource.FileResource -->
<!-- Source Filename: wiki/ecodex/example_deployment.ad -->

<!-- COMPLETE PAGE CONFIGURATION -->
<script>
    window.allData = {"reference":{"path":"wiki/ecodex","baseUrl":"/e-codex/ecodex","fileName":"example_deployment","extension":"html","usePrettyUrl":true,"link":"/e-codex/ecodex/wiki/ecodex/example_deployment"},"next":{"path":"wiki/ecodex","baseUrl":"/e-codex/ecodex","fileName":"configuration_update","extension":"html","usePrettyUrl":true,"link":"/e-codex/ecodex/wiki/ecodex/configuration_update"},"previous":{"path":"wiki/ecodex","baseUrl":"/e-codex/ecodex","fileName":"ecodex_protocol","extension":"html","usePrettyUrl":true,"link":"/e-codex/ecodex/wiki/ecodex/ecodex_protocol"},"description":"","title":"Example Deployment"};
</script>

<!-- end:debug info -->



<!-- start:inject styles -->
<link rel="stylesheet" type="text/css" href="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"/>
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css"/>
<link rel="stylesheet" type="text/css" href="/e-codex/ecodex/BsDoc/9e2fe29b/assets/css/bsdoc.css"/>
<link rel="stylesheet" type="text/css" href="/e-codex/ecodex/BsDoc/9e2fe29b/assets/css/orchidSearch.css"/>
<link rel="stylesheet" type="text/css" href="/e-codex/ecodex/assets/css/extraCss.css"/>
<link rel="stylesheet" type="text/css" href="/e-codex/ecodex/assets/ecodex/css/ecodex.css"/>
<link rel="stylesheet" type="text/css" href="/e-codex/ecodex/assets/css/pygments.css"/>
<!-- end:inject styles -->


</head>
<body>





<header class="navbar navbar-fixed-top bs-docs-nav">
    <div class="container">
        <div class="navbar-header" role="banner">
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/e-codex/ecodex">e-Codex</a>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
            <ul class="nav navbar-nav navbar-right">
                
                    
                        <li><a href="/e-codex/ecodex">Home</a></li>
                    
                
                    
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">connector<span class="caret"></span></a>
                            <ul class="dropdown-menu scrollable-menu">
                                
                                    <li><a href="/e-codex/ecodex/wiki/connector/evidence">Evidence</a></li>
                                
                                    <li><a href="/e-codex/ecodex/wiki/connector/modules_description">Modules</a></li>
                                
                                    <li><a href="/e-codex/ecodex/wiki/connector/use_cases">Use Cases</a></li>
                                
                            </ul>
                        </li>
                    
                
                    
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">ecodex<span class="caret"></span></a>
                            <ul class="dropdown-menu scrollable-menu">
                                
                                    <li><a href="/e-codex/ecodex/wiki/ecodex/ecodex_protocol">e-Codex Protocol specification</a></li>
                                
                                    <li><a href="/e-codex/ecodex/wiki/ecodex/example_deployment">Example Deployment</a></li>
                                
                                    <li><a href="/e-codex/ecodex/wiki/ecodex/configuration_update">Configuration Update</a></li>
                                
                                    <li><a href="/e-codex/ecodex/wiki/ecodex/differences_edelivery_ecodex">Differences betweend e-Codex and e-Delivery</a></li>
                                
                                    <li><a href="/e-codex/ecodex/wiki/ecodex/ecodex_attack_scenarios">Attack scenarios on e-Codex</a></li>
                                
                            </ul>
                        </li>
                    
                
            </ul>
        </nav>
    </div>
</header>




<div id="top"></div>



    /e-codex/ecodex/assets/ecodex/media/e-CODEX_home_1500-2.jpg

    <div class="bs-docs-masthead" id="jumbotron" style="background-image: url(&quot;/e-codex/ecodex/assets/ecodex/media/e-CODEX_home_1500-2.jpg&quot;);" >
        <div class="container">
            <h1 class="home-title">Example Deployment</h1>
        </div>
    </div>


<div class="container bs-docs-container">
    <div class="row">
        <div class="col-md-9" role="main">
        <nav aria-label="breadcrumb">
    <ul class="breadcrumb">
    
    
        <li class="breadcrumb-item"><a href="/e-codex/ecodex/wiki">Wiki</a></li>
    
    
    
        <li class="breadcrumb-item"><a href="/e-codex/ecodex/wiki/ecodex">E Codex</a></li>
    
    
    
        <li class="breadcrumb-item active" aria-current="page">Example Deployment</li>
    
    
    </ul>
</nav>
        

        
        
            
    <!-- start:inject components -->
    
        
            
                
                    
                        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The following setup describes an example setup of how the e-codex components can be installed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../assets/media/images/ecodex_example_deployment.png" alt="ecodex example deployment">
</div>
<div class="title">Figure 1. Deployment Graphics</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_components">Components</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Table Components</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Symbolizes the Internet, The connection between the Gateways is made through it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Firewall, DDOS-Filter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Firewall which protects the internal network. The information distributed over the CMT can be used to reduce the range of IP-Addresses which can connect through this firewall to the Apache Web Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache Web Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Apache Web Server in this Setup is responsible for terminating the TLS-Connection, Authenticating the connecting Web-Clients (the remote Gateway) by checking the client certificate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat Web Application Server - Domibus Gateway</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The domibus Gateway is deployed on a Tomcat Web Application Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat Web Application Server - Domibus Connector</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The domibusConnector is deployed on a Tomcat Web Application Server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat Web Application Server - Connector Client Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Connector Client Application is deployed on a Tomcat Web Application Server. This can be a national solution of an eCodeX-UseCase or the ReferenceImplementation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The database (MYSQL) provides for each application a different database.</p></td>
</tr>
</tbody>
</table>
<div class="literalblock">
<div class="content">
<pre>**Note that each application is running on it's own tomcat application server in this example!**</pre>
</div>
</div>
<div class="sect2">
<h3 id="_firewall_ddos_filter">Firewall, DDOS-Filter</h3>
<div class="paragraph">
<p>The firewall acts in this setup as simple IP-Filtering mechanism and ensures that only the partners of the ecodex-Network
can access the domibus gateway.</p>
</div>
</div>
<div class="sect2">
<h3 id="_example_apache_setup_and_alternatives">Example Apache Setup and alternatives</h3>
<div class="paragraph">
<p>Possible alternatives for the apache in this use case can be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>NGINX</p>
</li>
<li>
<p>IIS</p>
</li>
<li>
<p>Apache</p>
</li>
<li>
<p>Tomcat (using tomcat for TLS-terminiation)</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most commonly used webserver is the apache webserver. <a href="http://httpd.apache.org/" class="bare">http://httpd.apache.org/</a>
Apache is well doucmented and there are a lot of examples. Important for the setup is that
the tls (at least TLS 1.2 better TLS 1.3) encryption is enabled on apache. For this purpose the
apache server needs a certificate. You can obtain this certificate also over letsencrypt.</p>
</div>
<div class="paragraph">
<p>As apache is the most used webserver over the whole internet the next paragraphs will cover the e-Codex
specifics of an apache setup.</p>
</div>
<div class="sect3">
<h4 id="_setting_up_apache">Setting up Apache</h4>
<div class="paragraph">
<p>The apache webserver project site offers a good tutorial for setting up apache with TLS-encryption.
<a href="https://httpd.apache.org/docs/2.4/en/ssl/ssl_howto.html" class="bare">https://httpd.apache.org/docs/2.4/en/ssl/ssl_howto.html</a></p>
</div>
<div class="paragraph">
<p>After the apache setup is complete make sure that your webserver is reachable over https from
the public internet. And also export the whole public certificate chain to the CMT to share
your public key information with your e-Codex network partners. This is very important if you
are using a not well trusted certificate authority or a self signed certificate.</p>
</div>
<div class="paragraph">
<p>Your shared webserver certificate will become part of the trusted_webserver.jks keystore - and
only certificates within this store are considered trusted in the specific e-Codex Environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="_activating_tls_client_authentication2_way_ssl_on_apache">Activating TLS-client-authentication/2-way-SSL on apache</h4>
<div class="paragraph">
<p>Some e-Codex usecases may require also TLS-client authentication (aka 2-way-SSL). If the client authentication
is used also the client is authenticated at the server on TLS level. For this purpose the client presents
a client certificate to the webserver when opening the connection.</p>
</div>
<div class="paragraph">
<p>For activating 2-way-ssl on apache the following example configuration can be used. For further details
consult the apache manual!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;VirtualHost _default_:443&gt;
  SSLEngine on
  ServerName localhost:443
  SSLCertificateFile "${SRVROOT}/conf/ssl/server.crt"
  SSLCertificateKeyFile "${SRVROOT}/conf/ssl/server.key"
  # The following Parameter holds all trusted client certificates (2)
  # (and thier parent certificates) in pem-format.
  SSLCACertificateFile "${SRVROOT}/conf/ssl/trusted_clients.pem"
  DocumentRoot "${SRVROOT}/htdocs"

	CustomLog "${SRVROOT}/logs/ssl_request.log %t %h %{SSL_PROTOCOL}x %{SSL_CIPHER}x \"%r\" %b"
	&lt;Directory "${SRVROOT}/htdocs"&gt;
		Options Indexes Includes FollowSymLinks
		AllowOverride AuthConfig Limit FileInfo
        Require all granted
	&lt;/Directory&gt;

  #always protect the whole v-host to avoid post-handshake authentication!
  SSLVerifyClient Require
  SSLVerifyDepth 2 # clientcert(0)-&gt;intermediateCA(1)-&gt;RootCA(2)

  &lt;Location "/domibus/services/msh" &gt;
    ProxyPass &lt;gateway&gt;/domibus/services/msh
    ProxyPassReverse &lt;gateway&gt;/domibus/services/msh
  &lt;/Location&gt;

&lt;/virtualhost&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>SSLVerifyDepth <a href="https://httpd.apache.org/docs/2.4/en/mod/mod_ssl.html#sslverifydepth" class="bare">https://httpd.apache.org/docs/2.4/en/mod/mod_ssl.html#sslverifydepth</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Put the SSLVerifyClient Require directive into the vhost directive to avoid SSL renegotiation. Though apache
supports the SSLVerifyClient also within a Location directive but this would force the client to renegotiate the
TLS connection. This can lead to connection errors at the as webclient acting domibus gateway.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_additional_notes_on_webserver_setup">Additional Notes on Webserver Setup</h4>
<div class="ulist">
<ul>
<li>
<p>Ensure TLS 1.3 is activated and downgrading is not allowed!</p>
</li>
<li>
<p>Ensure that if the usecase requires it TLS-client authentication is activated</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_as4_gateway_domibus_gateway">AS4 Gateway / Domibus Gateway</h3>
<div class="paragraph">
<p>Most of the e-Codex installations are using the domibus gateway for fullfilling the AS4 interface. But there
are also known installations which are using IBM axway.</p>
</div>
<div class="paragraph">
<p>The eDelivery site of CEF lists some more alternatives:
<a href="https://ec.europa.eu/cefdigital/wiki/display/CEFDIGITAL/eDelivery+AS4+conformant+solutions" class="bare">https://ec.europa.eu/cefdigital/wiki/display/CEFDIGITAL/eDelivery+AS4+conformant+solutions</a></p>
</div>
<div class="paragraph">
<p>Keep in mind that if you are using some of the alternatives you still have to fullfill the e-Codex protocol demands.
(TODO: link to technical differences ecodex - eDelivery)</p>
</div>
<div class="sect3">
<h4 id="_example_setup">Example Setup</h4>
<div class="paragraph">
<p>For installing the domibus gateway the website provides a very good guide.
<a href="https://ec.europa.eu/cefdigital/wiki/display/CEFDIGITAL/Domibus" class="bare">https://ec.europa.eu/cefdigital/wiki/display/CEFDIGITAL/Domibus</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_tls_client_authentication2_way_ssl_authentication">TLS-client-authentication/2-way-SSL authentication</h4>
<div class="paragraph">
<p>For clientauthentication the information is located under:</p>
</div>
<div class="paragraph">
<p>&lt;domibus_tomcat&gt;/conf/domibus/clientauthentication.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-$xml" data-lang="$xml">&lt;http-conf:tlsClientParameters disableCNCheck="true" secureSocketProtocol="TLSv1.2"
  xmlns:http-conf="http://cxf.apache.org/transports/http/configuration"
  xmlns:security="http://cxf.apache.org/configuration/security"&gt;

  &lt;security:trustManagers&gt;
    &lt;!-- the following line contains the store which holds all trusted
    webserver certificates (file (b)) and thier parent certificates --&gt;
    &lt;security:keyStore type="JKS"
        password="changeit"
        file="${domibus.config.location}/keystores/trusted_https_servers.jks"
    /&gt;
  &lt;/security:trustManagers&gt;
  &lt;security:keyManagers keyPassword="12345"&gt;
  &lt;!-- this key store contains the web client private key,
  the public certificate is distributed with
  the trusted_https_clients store  --&gt;
    &lt;security:keyStore
        type="JKS"
        password="12345"
        file="${domibus.config.location}/keystores/https_client_keystore.jks"
    /&gt;
  &lt;/security:keyManagers&gt;
&lt;/http-conf:tlsClientParameters&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same file is also used to list the trusted webservers the domibus gateway is connecting to. The
certifcates (and thier intermediate and RootCAs) of the trusted webservers are listed within
the trusted_https_servers.jks truststore.</p>
</div>
<div class="paragraph">
<p>To activate clientauthentication the gateway must present the webserver a key. This key is
stored in the https_client_keystore.jks. This key is private! The corresponding certificate is
distributed within the trusted_webclients.pem file and used at the webserver to allow the connection.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_connector">Setting up Connector</h3>
<div class="paragraph">
<p>The additional features of the e-Codex protocol like</p>
</div>
<div class="ulist">
<ul>
<li>
<p>evidence handling</p>
</li>
<li>
<p>ASIC-S container building</p>
</li>
<li>
<p>TrustOK Token generatation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>are provided by the domibusConnector. The domibus connector comes with an installation manual.</p>
</div>
<div class="paragraph">
<p>(TODO: set link to connector manual!)</p>
</div>
</div>
</div>
</div>
                    
                
            
        
    
    <!-- end:inject components -->


        
        </div>

        <!-- Page navigation
        =========================================== -->
        <div class="col-md-3" role="complementary">
        <div class="bs-docs-sidebar hidden-print" id="bs-docs-sidebar">
    
        <section id="search" >
            <form data-orchid-search="">
                <div class="input-group">
                    <input type="text" name="query" id="query" class="form-control" placeholder="Search&hellip;">
                    <span class="input-group-btn"><button type="submit" class="btn btn-default">Go</button></span>
                </div>
            </form>
            <div id="search-results" data-orchid-search-results style="display: none;">
                <b>Search Results</b>
                <ul></ul>
            </div>
            <div id="search-progress" data-orchid-search-progress style="display: none;">
                <div class="loader">Loading...</div>
            </div>
        </section>
    

    <ul class="nav bs-docs-sidenav">
        
    </ul>

    
    <!-- start:inject components -->
    
    <!-- end:inject components -->



    <a class="back-to-top" href="#top">
        <i class="glyphicon glyphicon-chevron-up"></i> Back to top
    </a>
</div>

        </div>
    </div>
</div>


<div id="footer">
    <div class="container bs-docs-container">
    <footer class="bs-docs-footer" role="contentinfo">
    <div class="row">
        <div class="col-xs-12">
            <nav aria-label="navigateClasses">
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/e-codex/ecodex/wiki/ecodex/ecodex_protocol">
                                <span aria-hidden="true">&larr;</span>
                                <span>e-Codex Protocol specification</span>
                            </a>
                        </li>
                    

                    
                        <li class="next">
                            <a href="/e-codex/ecodex/wiki/ecodex/configuration_update">
                                <span>Configuration Update</span>
                                <span aria-hidden="true">&rarr;</span>
                            </a>
                        </li>
                    
                </ul>
            </nav>
        </div>
    </div>
    <div class="icons">
    
    
    
    </div>
    <br>
    <p>
    Documentation template based on the
    <a href="https://github.com/mistic100/jekyll-bootstrap-doc">Jekyll Bootstrap Doc</a>
    Jekyll theme by the <a href="https://getbootstrap.com">Bootstrap team</a>. Site created with
    <a href="https://orchid.netlify.com">Orchid</a>.
</p>

<ul class="bs-docs-footer-links muted">
    <li>Currently 1.0-SNAPSHOT</li>
</ul>

</footer>
    </div>
</div>


<!-- start:inject scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.3.0/bootbox.min.js"></script>
<script src="/e-codex/ecodex/BsDoc/9e2fe29b/assets/js/bsdoc.js"></script>
<script src="https://unpkg.com/lunr/lunr.js"></script>
<script src="/e-codex/ecodex/BsDoc/9e2fe29b/assets/js/orchidSearch.js"></script>
<script src="/e-codex/ecodex/assets/js/extraJs.js"></script>
<!-- end:inject scripts -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
    

<script>
    $(function () {
        window.colors = ['#4C376C', '#000000'];
                  
        buildNav();
    });
</script>

</body>
</html>